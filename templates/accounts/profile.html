{% extends "base.html" %}
{% block title %}Account Settings{% endblock %}
{% load static %}

{% block content %}
<div class="max-w-6xl mx-auto mt-10 grid grid-cols-1 md:grid-cols-4 gap-6">

    <!-- SIDEBAR -->
    <aside class="bg-white rounded-xl shadow border p-4 h-fit">
        <h3 class="font-bold text-gray-700 mb-4">Settings</h3>

        <button onclick="openTab('account')" class="sidebar-btn active-tab">
            Account
        </button>
        <button onclick="openTab('security')" class="sidebar-btn">
            Security
        </button>
        <button onclick="openTab('preferences')" class="sidebar-btn">
            Preferences
        </button>
    </aside>

    <!-- MAIN CONTENT -->
    <section class="md:col-span-3 space-y-6">

        <!-- PROFILE CARD -->
        <div class="bg-white rounded-xl shadow border p-6 flex items-center gap-6">
            <img id="previewImg"
                 src="{% if request.user.profile_image %}{{ request.user.profile_image.url }}{% else %}{% static 'default-user.png' %}{% endif %}"
                 class="w-28 h-28 rounded-full object-cover border">

            <div class="flex-1">
                <h2 class="text-2xl font-bold text-gray-800">{{ request.user.full_name }}</h2>
                <p class="text-gray-500">{{ request.user.email }}</p>
                <p class="text-gray-500">{{ request.user.phone }}</p>
            </div>

            <label class="btn-primary">
                Change Photo
                <input type="file" id="imgInput" class="hidden">
            </label>
        </div>

        <!-- FORM -->
        <form method="POST" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}

            <!-- ACCOUNT -->
            <div id="account" class="tab-content card">
                <h3 class="section-title">Account Information</h3>
                {{ form.full_name.label_tag }}{{ form.full_name }}
                {{ form.email.label_tag }}{{ form.email }}
                {{ form.phone.label_tag }}{{ form.phone }}
                {{ form.address.label_tag }}{{ form.address }}
            </div>

            <!-- SECURITY -->
            <div id="security" class="tab-content hidden card">
                <h3 class="section-title">Security</h3>
                <input type="password" name="old_password" placeholder="Current Password" class="input-box">
                <input type="password" name="new_password" placeholder="New Password" class="input-box">
                <input type="password" name="confirm_password" placeholder="Confirm Password" class="input-box">
            </div>

            <!-- PREFERENCES -->
            <div id="preferences" class="tab-content hidden card">
                <h3 class="section-title">Preferences</h3>

                <label class="check-row">
                    <input type="checkbox" name="email_notifications">
                    Email Notifications
                </label>

                <label class="check-row">
                    <input type="checkbox" name="sms_notifications">
                    SMS Alerts
                </label>

                <label class="check-row">
                    <input type="checkbox" name="dark_mode">
                    Dark Mode
                </label>
            </div>

            <button class="btn-save">
                Save Changes
            </button>
        </form>
    </section>
</div>

<style>
.input-box {
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #d1d5db;
    margin-bottom: 12px;
}

.sidebar-btn {
    display: block;
    width: 100%;
    text-align: left;
    padding: 10px;
    border-radius: 8px;
    font-weight: 600;
    color: #475569;
    margin-bottom: 6px;
    transition: .2s;
}

.sidebar-btn:hover {
    background: #f1f5f9;
}

.active-tab {
    background: #2563eb;
    color: white !important;
}

.card {
    background: white;
    border-radius: 14px;
    padding: 24px;
    box-shadow: 0 4px 12px rgba(0,0,0,.05);
}

.section-title {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 16px;
}

.btn-primary {
    background: #2563eb;
    color: white;
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
}

.btn-save {
    width: 100%;
    background: #2563eb;
    color: white;
    padding: 14px;
    border-radius: 12px;
    font-size: 18px;
    font-weight: 700;
}

.check-row {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-bottom: 12px;
}
</style>

<script>
function openTab(tab) {
    document.querySelectorAll(".tab-content").forEach(el => el.classList.add("hidden"));
    document.getElementById(tab).classList.remove("hidden");

    document.querySelectorAll(".sidebar-btn").forEach(btn => btn.classList.remove("active-tab"));
    event.target.classList.add("active-tab");
}

document.getElementById("imgInput").addEventListener("change", function () {
    const reader = new FileReader();
    reader.onload = () => previewImg.src = reader.result;
    reader.readAsDataURL(this.files[0]);
});
</script>
{% endblock %}
